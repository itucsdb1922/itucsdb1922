

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Zeynep Yetiştiren &mdash; ITUCSDB1922  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parts Implemented by Cihat Akkiraz" href="Cihat Akkiraz.html" />
    <link rel="prev" title="Parts Implemented by Fatih Altınpınar" href="fatih.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1922
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#database-design">Database Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code">Code</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Batuhan Faik Derinbay.html">Parts Implemented by Batuhan Faik Derinbay</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatih.html">Parts Implemented by Fatih Altınpınar</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Parts Implemented by Zeynep Yetiştiren</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tables">Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#view-models">View Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#database-queries">Database Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#templates">Templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Cihat Akkiraz.html">Parts Implemented by Cihat Akkiraz</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1922</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Zeynep Yetiştiren</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/Zeynep Yetistiren.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-zeynep-yetistiren">
<h1>Parts Implemented by Zeynep Yetiştiren<a class="headerlink" href="#parts-implemented-by-zeynep-yetistiren" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tables">
<h2>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h2>
<p>Staff, Facility and Staff-Facility tables and their CRUD operations are written by this user. Table definitions and attributes can be seen in  <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file. Also, they are shown below.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Facility Table</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">FACILITY</span><span class="p">(</span>
    <span class="n">id</span>                                  <span class="nb">SERIAL</span>              <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">campus_id</span>           <span class="nb">SERIAL</span>      <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span>                            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>     <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">shortened_name</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">number_of_workers</span>       <span class="nb">INT</span><span class="p">,</span>
    <span class="k">size</span>                    <span class="nb">INT</span><span class="p">,</span>
    <span class="n">expenses</span>                <span class="nb">INT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">CAMPUS</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Staff Table</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">STAFF</span><span class="p">(</span>
    <span class="n">id</span>              <span class="nb">BIGINT</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">manager_name</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">absences</span>            <span class="nb">INT</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">hire_date</span>       <span class="nb">DATE</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">authority_lvl</span>   <span class="nb">INT</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">department</span>      <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">social_sec_no</span>   <span class="nb">INT</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">PEOPLE</span> <span class="p">(</span><span class="n">tr_id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Staff-Facility Table</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">STAFF_FACIL</span><span class="p">(</span>
    <span class="n">title</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>     <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">from_date</span>           <span class="nb">DATE</span>            <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">to_date</span>             <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">salary</span>              <span class="nb">INT</span>             <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">facility_id</span>         <span class="nb">BIGINT</span>          <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">staff_id</span>        <span class="nb">BIGINT</span>          <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">duty</span>            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>         <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">facility_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">FACILITY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">STAFF</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">facility_id</span><span class="p">,</span><span class="n">staff_id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="example-data">
<h3>Example Data<a class="headerlink" href="#example-data" title="Permalink to this headline">¶</a></h3>
<p>Some examples for these tables are shown below. More examples can be seen in <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Example Data for Staff Table</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">staff</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">manager_name</span><span class="p">,</span><span class="n">absences</span><span class="p">,</span><span class="n">hire_date</span><span class="p">,</span><span class="n">social_sec_no</span><span class="p">,</span><span class="n">department</span><span class="p">,</span><span class="n">authority_lvl</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Manager1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span><span class="s1">&#39;Finance &#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">staff</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">manager_name</span><span class="p">,</span><span class="n">absences</span><span class="p">,</span><span class="n">hire_date</span><span class="p">,</span><span class="n">social_sec_no</span><span class="p">,</span><span class="n">department</span><span class="p">,</span><span class="n">authority_lvl</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Manager2&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span><span class="s1">&#39;12344&#39;</span><span class="p">,</span><span class="s1">&#39;Information Tech&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">staff</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">manager_name</span><span class="p">,</span><span class="n">absences</span><span class="p">,</span><span class="n">hire_date</span><span class="p">,</span><span class="n">social_sec_no</span><span class="p">,</span><span class="n">department</span><span class="p">,</span><span class="n">authority_lvl</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;Manager3&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span><span class="s1">&#39;Information Tech&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Example Data for Facility Table</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">facility</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="p">,</span> <span class="n">number_of_workers</span><span class="p">,</span> <span class="k">size</span><span class="p">,</span> <span class="n">expenses</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Yemekhane&#39;</span><span class="p">,</span> <span class="s1">&#39;YMK&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;1400&#39;</span><span class="p">,</span> <span class="s1">&#39;70000&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">facility</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="p">,</span> <span class="n">number_of_workers</span><span class="p">,</span> <span class="k">size</span><span class="p">,</span> <span class="n">expenses</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Kütüphane&#39;</span><span class="p">,</span> <span class="s1">&#39;LIB&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;1400&#39;</span><span class="p">,</span> <span class="s1">&#39;50000&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">facility</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="p">,</span> <span class="n">number_of_workers</span><span class="p">,</span> <span class="k">size</span><span class="p">,</span> <span class="n">expenses</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Bilgi Işlem&#39;</span><span class="p">,</span> <span class="s1">&#39;BIDB&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;1400&#39;</span><span class="p">,</span> <span class="s1">&#39;80000&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Example Data for Staff-Facility Table</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">staff_facil</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">,</span> <span class="n">duty</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;Manager &#39;</span><span class="p">,</span><span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;Leads staff&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">staff_facil</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">,</span> <span class="n">duty</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;Security&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Secure books&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">staff_facil</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">,</span> <span class="n">duty</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;Project Assistant&#39;</span><span class="p">,</span><span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;Help the group&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<p>Classes are created for table definitions in Python. Classes can be examined in <code class="docutils literal notranslate"><span class="pre">staff.py</span></code>, <code class="docutils literal notranslate"><span class="pre">facility.py</span></code> and <code class="docutils literal notranslate"><span class="pre">staff_facil.py</span></code> files.</p>
<p>Classes Staff, Facility and Staff_facil are created and implemented by this user and their are shown below.</p>
<div class="section" id="staff">
<h3>Staff<a class="headerlink" href="#staff" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Staff Class</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Staff</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">manager_name</span><span class="p">,</span><span class="n">absences</span><span class="p">,</span><span class="n">hire_date</span><span class="p">,</span><span class="n">authority_lvl</span><span class="p">,</span><span class="n">department</span><span class="p">,</span><span class="n">social_sec_no</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager_name</span> <span class="o">=</span> <span class="n">manager_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absences</span> <span class="o">=</span> <span class="n">absences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hire_date</span> <span class="o">=</span> <span class="n">hire_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authority_lvl</span> <span class="o">=</span> <span class="n">authority_lvl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">department</span> <span class="o">=</span> <span class="n">department</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">social_sec_no</span> <span class="o">=</span> <span class="n">social_sec_no</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="facility">
<h3>Facility<a class="headerlink" href="#facility" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Facility Class</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Facility</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">campus_id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">shortened_name</span><span class="p">,</span><span class="n">number_of_workers</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span><span class="n">expenses</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortened_name</span><span class="o">=</span><span class="n">shortened_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_workers</span><span class="o">=</span><span class="n">number_of_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expenses</span> <span class="o">=</span> <span class="n">expenses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">campus_id</span> <span class="o">=</span> <span class="n">campus_id</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="staff-facil">
<h3>Staff_facil<a class="headerlink" href="#staff-facil" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Staff_facil class`</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Staff_facil</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">from_date</span><span class="p">,</span><span class="n">to_date</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">facility_id</span><span class="p">,</span><span class="n">staff_id</span><span class="p">,</span><span class="n">duty</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staff_id</span> <span class="o">=</span> <span class="n">staff_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">=</span><span class="n">to_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="n">from_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salary</span> <span class="o">=</span> <span class="n">salary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facility_id</span> <span class="o">=</span> <span class="n">facility_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duty</span> <span class="o">=</span> <span class="n">duty</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="view-models">
<h2>View Models<a class="headerlink" href="#view-models" title="Permalink to this headline">¶</a></h2>
<p>View models handle GET/POST requests and render pages accordingly.</p>
<p>Models implemented by this user can be found in <code class="docutils literal notranslate"><span class="pre">views.py</span></code> file and shown below.</p>
<div class="section" id="id1">
<h3>Staff<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>All operations for Staff Table and all CRUD operations for Staff-Facility Table are implemented in <code class="docutils literal notranslate"><span class="pre">staff_add_page</span></code> function as follows.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Model for the Staff and Staff-Facility page</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">staff_add_page</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
    <span class="n">all_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_staff</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;search_staff&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Searching staff.. id:&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staff-id&quot;</span><span class="p">))</span>
        <span class="n">found_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staff-id&quot;</span><span class="p">))</span>
        <span class="n">person_info</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_person</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staff-id&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">found_staff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No staff has been found.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff found!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_search.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">found_staff</span><span class="p">,</span> <span class="n">staff_id</span><span class="o">=</span><span class="n">found_staff</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">person_info</span><span class="o">=</span><span class="n">person_info</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;delete_staff&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>

        <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Delete staff!&quot;</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">delete_staff</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">staff_id</span><span class="p">))</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff Deleted!&#39;</span><span class="p">)</span>
        <span class="n">all_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_staff</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                               <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>


    <span class="k">elif</span> <span class="s1">&#39;update_staff&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATEEEE&quot;</span><span class="p">)</span>
        <span class="n">old_staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id&quot;</span><span class="p">]</span>
        <span class="n">manager_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manager_name&quot;</span><span class="p">)</span>
        <span class="n">absences</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;absences&quot;</span><span class="p">)</span>
        <span class="n">hire_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hire_date&quot;</span><span class="p">)</span>
        <span class="n">authority</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authority_lvl&quot;</span><span class="p">)</span>
        <span class="n">department</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;department&quot;</span><span class="p">)</span>
        <span class="n">social_sec</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">)</span>

        <span class="n">new_staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">old_staff_id</span><span class="p">,</span> <span class="n">manager_name</span><span class="o">=</span><span class="n">manager_name</span><span class="p">,</span> <span class="n">absences</span><span class="o">=</span><span class="n">absences</span><span class="p">,</span>
                          <span class="n">hire_date</span><span class="o">=</span><span class="n">hire_date</span><span class="p">,</span>
                          <span class="n">social_sec_no</span><span class="o">=</span><span class="n">social_sec</span><span class="p">,</span> <span class="n">department</span><span class="o">=</span><span class="n">department</span><span class="p">,</span> <span class="n">authority_lvl</span><span class="o">=</span><span class="n">authority</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">update_staff</span><span class="p">(</span><span class="n">new_staff</span><span class="p">)</span>

        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff Updated!&#39;</span><span class="p">)</span>
        <span class="n">all_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_staff</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span><span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                               <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;more_info&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">s_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id&quot;</span><span class="p">]</span>
        <span class="n">staff_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>
        <span class="n">the_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>
        <span class="n">facils</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">SF</span> <span class="ow">in</span> <span class="n">staff_facilities</span><span class="p">:</span>
            <span class="n">facility_</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">SF</span><span class="o">.</span><span class="n">facility_id</span><span class="p">)</span>
            <span class="n">facils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility_</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">facils</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No facility information is given for this Staff&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                               <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;add_staff_facil&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="c1"># Check validation</span>

        <span class="n">s_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id&quot;</span><span class="p">]</span>
        <span class="n">staff_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>
        <span class="n">the_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>
        <span class="n">facils</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">SF</span> <span class="ow">in</span> <span class="n">staff_facilities</span><span class="p">:</span>
            <span class="n">facility_</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">SF</span><span class="o">.</span><span class="n">facility_id</span><span class="p">)</span>
            <span class="n">facils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility_</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="n">from_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from_date&quot;</span><span class="p">)</span>
        <span class="n">to_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to_date&quot;</span><span class="p">)</span>
        <span class="n">salary</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">)</span>
        <span class="n">facility_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;facility_id&quot;</span><span class="p">)</span>
        <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staff_id&quot;</span><span class="p">)</span>
        <span class="n">duty</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duty&quot;</span><span class="p">)</span>
        <span class="n">new_SF</span> <span class="o">=</span> <span class="n">Staff_facil</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span> <span class="n">salary</span><span class="o">=</span><span class="n">salary</span><span class="p">,</span>
                             <span class="n">facility_id</span><span class="o">=</span><span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_id</span><span class="o">=</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">duty</span><span class="o">=</span><span class="n">duty</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">add_staff_facility</span><span class="p">(</span><span class="n">new_SF</span><span class="p">)</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff-Facility Connection successfully added!&#39;</span><span class="p">)</span>
            <span class="n">staff_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Length of staff_facilities array:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">staff_facilities</span><span class="p">))</span>
            <span class="n">facils</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff-Facility Connection Not added!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span><span class="p">):</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;This connection already exists&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                                       <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                       <span class="n">error</span><span class="o">=</span><span class="s2">&quot;ID already exists&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForeignKeyViolation</span><span class="p">):</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Could not find the given staff Id or Facility Id&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                                       <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                       <span class="n">error</span><span class="o">=</span><span class="s2">&quot;No ID&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                                       <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                       <span class="n">error</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;-----&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">SF</span> <span class="ow">in</span> <span class="n">staff_facilities</span><span class="p">:</span>
            <span class="n">facility_</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">SF</span><span class="o">.</span><span class="n">facility_id</span><span class="p">)</span>
            <span class="n">facils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                               <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;delete_SF&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id_delete&quot;</span><span class="p">]</span>
        <span class="n">facility_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;facility_id_delete&quot;</span><span class="p">]</span>
        <span class="n">db</span><span class="o">.</span><span class="n">delete_staff_facil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">staff_id</span><span class="p">),</span> <span class="n">facility_id</span><span class="p">)</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff-Facility Connection Deleted!&#39;</span><span class="p">)</span>
        <span class="n">the_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">staff_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">facils</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">SF</span> <span class="ow">in</span> <span class="n">staff_facilities</span><span class="p">:</span>
            <span class="n">facility_</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">SF</span><span class="o">.</span><span class="n">facility_id</span><span class="p">)</span>
            <span class="n">facils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                               <span class="n">staff_facils</span><span class="o">=</span><span class="n">staff_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;edit_SF&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;staff_id_edit&quot;</span><span class="p">]</span>
        <span class="n">staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">facility_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;facility_id_edit&quot;</span><span class="p">]</span>
        <span class="n">staff_facility</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">facil</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">facility_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;edit_staff_facil.html&quot;</span><span class="p">,</span> <span class="n">the_staff</span><span class="o">=</span><span class="n">staff</span><span class="p">,</span> <span class="n">facility</span><span class="o">=</span><span class="n">facil</span><span class="p">,</span>
                               <span class="n">SF</span><span class="o">=</span><span class="n">staff_facility</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;edit_staff_facil&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
        <span class="n">from_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from_date&quot;</span><span class="p">)</span>
        <span class="n">to_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to_date&quot;</span><span class="p">)</span>
        <span class="n">salary</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">)</span>
        <span class="n">facility_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;facility_id&quot;</span><span class="p">)</span>
        <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staff_id&quot;</span><span class="p">)</span>
        <span class="n">duty</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duty&quot;</span><span class="p">)</span>
        <span class="n">new_SF</span> <span class="o">=</span> <span class="n">Staff_facil</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="n">to_date</span><span class="p">,</span> <span class="n">salary</span><span class="o">=</span><span class="n">salary</span><span class="p">,</span>
                             <span class="n">facility_id</span><span class="o">=</span><span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_id</span><span class="o">=</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">duty</span><span class="o">=</span><span class="n">duty</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">update_SF</span><span class="p">(</span><span class="n">new_SF</span><span class="p">)</span>

        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff-Facility Connection Updated!&#39;</span><span class="p">)</span>
        <span class="n">all_SF</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">the_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">staff_id</span><span class="p">)</span>
        <span class="n">facils</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">SF</span> <span class="ow">in</span> <span class="n">staff_facilities</span><span class="p">:</span>
            <span class="n">facility_</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">SF</span><span class="o">.</span><span class="n">facility_id</span><span class="p">)</span>
            <span class="n">facils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff_facility.html&quot;</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="n">the_staff</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facils</span><span class="p">,</span>
                               <span class="n">staff_facils</span><span class="o">=</span><span class="n">all_SF</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Staff addition</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">validation_staff</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Input NOT Valid!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">manager_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;manager_name&quot;</span><span class="p">]</span>
            <span class="n">staff_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">absences</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;absences&quot;</span><span class="p">]</span>
            <span class="n">hire_date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hire_date&quot;</span><span class="p">]</span>
            <span class="n">authority</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;authority_lvl&quot;</span><span class="p">]</span>
            <span class="n">department</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">]</span>
            <span class="n">social_sec</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">]</span>
            <span class="n">new_staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">manager_name</span><span class="o">=</span><span class="n">manager_name</span><span class="p">,</span> <span class="n">absences</span><span class="o">=</span><span class="n">absences</span><span class="p">,</span>
                              <span class="n">hire_date</span><span class="o">=</span><span class="n">hire_date</span><span class="p">,</span> <span class="n">social_sec_no</span><span class="o">=</span><span class="n">social_sec</span><span class="p">,</span> <span class="n">department</span><span class="o">=</span><span class="n">department</span><span class="p">,</span>
                              <span class="n">authority_lvl</span><span class="o">=</span><span class="n">authority</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">add_staff</span><span class="p">(</span><span class="n">new_staff</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff successfully added!&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Staff NOT added!&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span><span class="p">):</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;A staff with this ID already exists&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                                           <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="s2">&quot;A staff with this ID already exists&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForeignKeyViolation</span><span class="p">):</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No people exists with this TR ID&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                                           <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="s2">&quot;No people exists with this TR ID&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                                           <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;-----&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;staff_add_page&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Form validation function for the Staff form</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validation_staff</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">form</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>

    <span class="n">form_id</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_staff</span><span class="p">(</span><span class="n">form_id</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This staff is already registered with the given id.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;This staff is already registered with the given id&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ID cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;ID cannot be empty.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hire_date&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;hire_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hire Date cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Hire Date cannot be empty.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Social Security Number cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Social Security Number cannot be empty&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">get_person</span><span class="p">(</span><span class="n">form_id</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;There is no Person with the given ID.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No people exists with this TR ID&#39;</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;manager_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manager_name&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;absences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;absences&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hire_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hire_date&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;authority_lvl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authority_lvl&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;department&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;social_sec_no&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="staff-facility">
<h3>Staff-Facility<a class="headerlink" href="#staff-facility" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Model for the Staff-Facility page</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">staff_facil_page</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
    <span class="n">all_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_staff</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Function for searching Campuses by Campus ID</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
    <span class="n">campuses</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_campuses</span><span class="p">()</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">campus</span> <span class="ow">in</span> <span class="n">campuses</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">campus_id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id2">
<h3>Facility<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Model for the Facility page</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">facility_page</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
    <span class="n">all_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_facility</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">)</span>


    <span class="k">elif</span> <span class="s1">&#39;facility_search&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">facil</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;facility_id&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">facil</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No facility has been found.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Facility found!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility_search.html&quot;</span><span class="p">,</span> <span class="n">facility</span><span class="o">=</span><span class="n">facil</span><span class="p">,</span> <span class="n">facility_id</span><span class="o">=</span><span class="n">facil</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                    <span class="n">by_campus</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;delete_facility&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">f_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;facility_id&quot;</span><span class="p">]</span>
        <span class="n">db</span><span class="o">.</span><span class="n">delete_facility</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">f_id</span><span class="p">))</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Facility Deleted!&#39;</span><span class="p">)</span>
        <span class="n">all_f</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_facility</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_f</span><span class="p">,</span>
                               <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;search_facility_campus&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
        <span class="n">campus_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;find_campus_id&quot;</span><span class="p">]</span>
        <span class="n">campus</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span>
        <span class="n">c_name</span> <span class="o">=</span> <span class="n">campus</span><span class="o">.</span><span class="n">name</span>
        <span class="n">facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility_from_campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">facilities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;There is no facility in this Campus.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility_search.html&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">facilities</span><span class="p">,</span> <span class="n">campus_name</span><span class="o">=</span><span class="n">c_name</span><span class="p">,</span>
                               <span class="n">by_campus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;update_facility&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">campus_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;campus_id&quot;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shortened_name&quot;</span><span class="p">]</span>
        <span class="n">num_worker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;number_of_workers&quot;</span><span class="p">]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
        <span class="n">expense</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;expenses&quot;</span><span class="p">]</span>
        <span class="n">new_facil</span> <span class="o">=</span> <span class="n">Facility</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="o">=</span><span class="n">short_name</span><span class="p">,</span>
                             <span class="n">number_of_workers</span><span class="o">=</span><span class="n">num_worker</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">expenses</span><span class="o">=</span><span class="n">expense</span><span class="p">)</span>

        <span class="n">db</span><span class="o">.</span><span class="n">update_facility</span><span class="p">(</span><span class="n">new_facil</span><span class="p">)</span>

        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Facility Updated!&#39;</span><span class="p">)</span>
        <span class="n">all_staff</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_staff</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;staff.html&quot;</span><span class="p">,</span> <span class="n">staffs</span><span class="o">=</span><span class="n">all_staff</span><span class="p">,</span>
                               <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">validation_facility</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="c1"># flash(&#39;Input NOT Valid!&#39;)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="n">campus_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;campus_id&quot;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">short_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shortened_name&quot;</span><span class="p">]</span>
            <span class="n">num_worker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;number_of_workers&quot;</span><span class="p">]</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="n">expense</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;expenses&quot;</span><span class="p">]</span>
            <span class="n">new_facil</span> <span class="o">=</span> <span class="n">Facility</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="o">=</span><span class="n">short_name</span><span class="p">,</span>
                                 <span class="n">number_of_workers</span><span class="o">=</span><span class="n">num_worker</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">expenses</span><span class="o">=</span><span class="n">expense</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">add_facility</span><span class="p">(</span><span class="n">new_facil</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Facility successfully added!&#39;</span><span class="p">)</span>
                <span class="n">all_facilities</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_facility</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Facility NOT added!&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span><span class="p">):</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;A Facility with this ID already exists&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="s2">&quot;A Facility with this ID already exists&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForeignKeyViolation</span><span class="p">):</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No campus exists with this ID&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="s2">&quot;No campus exists with this ID&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;facility.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">,</span>
                                           <span class="n">error</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;-----&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span>
                <span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;facility_page&quot;</span><span class="p">,</span> <span class="n">facilities</span><span class="o">=</span><span class="n">all_facilities</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Form validation function for the Facility form</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validation_facility</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">form</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>

    <span class="n">form_id</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="n">form_campus_id</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;campus_id&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">get_facility</span><span class="p">(</span><span class="n">form_id</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This facility is already registered with the given id.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;This facility is already registered with the given id&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ID cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;ID cannot be empty.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;campus_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;campus_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Campus ID cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Campus ID cannot be empty.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Name cannot be empty.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Name cannot be empty&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">find_campus</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">form_campus_id</span><span class="p">)):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;There is no Campus with the given Campus ID.&quot;</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;There is no Campus with the given Campus ID.&#39;</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;campus_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;campus_id&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shortened_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shortened_name&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;number_of_workers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;number_of_workers&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;expenses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;expenses&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="database-queries">
<h2>Database Queries<a class="headerlink" href="#database-queries" title="Permalink to this headline">¶</a></h2>
<p>Database queries are handled via <code class="docutils literal notranslate"><span class="pre">database.py</span></code> file by constructing a Database class and using <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> library as the PostgreSQL driver.</p>
<p>Below are the related class methods implemented by this user:</p>
<div class="section" id="id3">
<h3>Staff<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Staff table</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into staff (id, manager_name, absences, hire_date, authority_lvl,department, social_sec_no) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">manager_name</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">absences</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">hire_date</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">authority_lvl</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
                               <span class="n">staff</span><span class="o">.</span><span class="n">social_sec_no</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">get_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from staff where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_id</span><span class="p">,))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="n">found_staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">(</span><span class="o">*</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[:])</span>
    <span class="k">return</span> <span class="n">found_staff</span>

<span class="k">def</span> <span class="nf">get_all_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">all_staff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from staff order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">staf</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">all_staff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">staf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_staff</span>
<span class="k">def</span> <span class="nf">delete_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from staff where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update staff set  manager_name = </span><span class="si">%s</span><span class="s2">, absences = </span><span class="si">%s</span><span class="s2">, hire_date = </span><span class="si">%s</span><span class="s2">, authority_lvl = </span><span class="si">%s</span><span class="s2">,department = </span><span class="si">%s</span><span class="s2">, social_sec_no = </span><span class="si">%s</span><span class="s2"> where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span> <span class="n">staff</span><span class="o">.</span><span class="n">manager_name</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">absences</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">hire_date</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">authority_lvl</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
                               <span class="n">staff</span><span class="o">.</span><span class="n">social_sec_no</span><span class="p">,</span> <span class="n">staff</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id4">
<h3>Facility<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Facility table</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">facility_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from facility where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">facility_id</span><span class="p">,))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="n">found_facility</span> <span class="o">=</span> <span class="n">Facility</span><span class="p">(</span><span class="o">*</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[:])</span>
    <span class="k">return</span> <span class="n">found_facility</span>
<span class="k">def</span> <span class="nf">get_all_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">all_facility</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from facility order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">facil</span> <span class="o">=</span> <span class="n">Facility</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">all_facility</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facil</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_facility</span>
<span class="k">def</span> <span class="nf">delete_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">facility_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from facility where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">facility_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
<span class="k">def</span> <span class="nf">add_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">facility</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRYİNG TO ADD:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into facility (id, campus_id, name, shortened_name,number_of_workers,size,expenses) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">facility</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span>
                               <span class="n">facility</span><span class="o">.</span><span class="n">number_of_workers</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">expenses</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
<span class="k">def</span> <span class="nf">get_facility_from_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">):</span>
    <span class="n">facilities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from facility where (campus_id = </span><span class="si">%s</span><span class="s2">) order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus_id</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">facility</span> <span class="o">=</span> <span class="n">Facility</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">facilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facility</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">facilities</span>
<span class="k">def</span> <span class="nf">update_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">facility</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update facility set  id = </span><span class="si">%s</span><span class="s2">, campus_id = </span><span class="si">%s</span><span class="s2">, name = </span><span class="si">%s</span><span class="s2">, shortened_name = </span><span class="si">%s</span><span class="s2">,number_of_workers = </span><span class="si">%s</span><span class="s2">, size = </span><span class="si">%s</span><span class="s2">, expenses = </span><span class="si">%s</span><span class="s2"> where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">facility</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span> <span class="n">facility</span><span class="o">.</span><span class="n">number_of_workers</span><span class="p">,</span>
                               <span class="n">facility</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                               <span class="n">facility</span><span class="o">.</span><span class="n">expenses</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id5">
<h3>Staff-Facility<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Staff-Facility table</span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_facility_from_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">):</span>
    <span class="n">staff_facilities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from staff_facil where (staff_id = </span><span class="si">%s</span><span class="s2">) order by staff_id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_id</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">SF</span> <span class="o">=</span> <span class="n">Staff_facil</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">staff_facilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SF</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">staff_facilities</span>
<span class="k">def</span> <span class="nf">get_a_facility_from_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">staff_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from staff_facil where (staff_id = </span><span class="si">%s</span><span class="s2">) order by staff_id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">add_staff_facility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff_facil</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRYİNG TO ADD:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into staff_facil (title,from_date,to_date,salary,facility_id,staff_id,duty) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_facil</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
                               <span class="n">staff_facil</span><span class="o">.</span><span class="n">facility_id</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">duty</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
<span class="k">def</span> <span class="nf">delete_staff_facil</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">facility_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from staff_facil where (staff_id= </span><span class="si">%s</span><span class="s2"> and facility_id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">staff_id</span><span class="p">,</span><span class="n">facility_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_SF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">SF</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update staff_facil set  title = </span><span class="si">%s</span><span class="s2">, from_date = </span><span class="si">%s</span><span class="s2">, to_date= </span><span class="si">%s</span><span class="s2">, salary = </span><span class="si">%s</span><span class="s2">, duty = </span><span class="si">%s</span><span class="s2"> where (staff_id = </span><span class="si">%s</span><span class="s2"> and facility_id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
                               <span class="n">staff_facil</span><span class="o">.</span><span class="n">duty</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">staff_id</span><span class="p">,</span> <span class="n">staff_facil</span><span class="o">.</span><span class="n">facility_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Following templates are written by <strong>this user</strong>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">edit_staff_facil.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">facility.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">facility_search.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staff.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staff_facility.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staff_search.html</span></code></p></li>
</ul>
</dd>
<dt>Contribution is made to the files below <strong>this user</strong> and <strong>other teammates</strong>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">layout.html</span></code></p></li>
</ul>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Cihat Akkiraz.html" class="btn btn-neutral float-right" title="Parts Implemented by Cihat Akkiraz" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fatih.html" class="btn btn-neutral float-left" title="Parts Implemented by Fatih Altınpınar" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ITUCSDB1922

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>