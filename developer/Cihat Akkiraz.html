

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Cihat Akkiraz &mdash; ITUCSDB1922  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Parts Implemented by Zeynep Yetiştiren" href="Zeynep Yetistiren.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1922
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#database-design">Database Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code">Code</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Batuhan Faik Derinbay.html">Parts Implemented by Batuhan Faik Derinbay</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatih.html">Parts Implemented by Fatih Altınpınar</a></li>
<li class="toctree-l3"><a class="reference internal" href="Zeynep Yetistiren.html">Parts Implemented by Zeynep Yetiştiren</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Parts Implemented by Cihat Akkiraz</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#campus">Campus</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#view-models">View Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#database-queries">Database Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#templates">Templates</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1922</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Cihat Akkiraz</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/Cihat Akkiraz.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-cihat-akkiraz">
<h1>Parts Implemented by Cihat Akkiraz<a class="headerlink" href="#parts-implemented-by-cihat-akkiraz" title="Permalink to this headline">¶</a></h1>
<p>Campus, Faculty and Departments tables that are implemented by this team member will be explained here.</p>
<div class="section" id="campus">
<h2>Campus<a class="headerlink" href="#campus" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<img alt="ERD of Akkiraz" src="../_images/cihat_erd.png" />
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">SQL of Campus Table</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">CAMPUS</span><span class="p">(</span>
    <span class="n">id</span>                          <span class="nb">SERIAL</span>              <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span>                    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>     <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">address</span>                 <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>     <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">city</span>                    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
    <span class="k">size</span>                    <span class="nb">INT</span><span class="p">,</span>
    <span class="n">foundation_date</span>     <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">phone_number</span>        <span class="nb">CHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">campus_image_extension</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span><span class="p">(</span><span class="s1">&#39;NO_IMAGE&#39;</span><span class="p">),</span>
    <span class="n">campus_image_data</span>   <span class="n">bytea</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">SQL of Faculty Table</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">FACULTY</span><span class="p">(</span>
    <span class="n">id</span>                                  <span class="nb">SERIAL</span>              <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">campus_id</span>           <span class="nb">INT</span>         <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span>                            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">shortened_name</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">address</span>                         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span>
    <span class="n">foundation_date</span>         <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">phone_number</span>            <span class="nb">CHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">CAMPUS</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">SQL of Department Table</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">DEPARTMENT</span><span class="p">(</span>
    <span class="n">id</span>                                  <span class="nb">SERIAL</span>              <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">faculty_id</span>                      <span class="nb">INT</span>                     <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span>                            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">shortened_name</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">block_number</span>            <span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">budget</span>                          <span class="nb">INT</span><span class="p">,</span>
    <span class="n">foundation_date</span>         <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">phone_number</span>            <span class="nb">CHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">FACULTY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<p>Classes are python objects for the user types that ITU DataBees uses.</p>
<p>Classes implemented by this user can be examined in detailed with the given source code from various files.</p>
<p>Classes campus, faculty and department are created and implemented by this user and their corresponding codes are given below.</p>
<div class="section" id="id1">
<h3>Campus<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Course class from <code class="docutils literal notranslate"><span class="pre">campus.py</span></code></span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Campus</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">foundation_date</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">,</span> <span class="n">image_extension</span><span class="p">,</span> <span class="n">image_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">campus_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foundation_date</span> <span class="o">=</span> <span class="n">foundation_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone_number</span> <span class="o">=</span> <span class="n">phone_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_extension</span> <span class="o">=</span> <span class="n">image_extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_data</span> <span class="o">=</span> <span class="n">image_data</span>

    <span class="k">def</span> <span class="nf">get_campus_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="faculty">
<h3>Faculty<a class="headerlink" href="#faculty" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Faculty class from <code class="docutils literal notranslate"><span class="pre">faculty.py</span></code></span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Faculty</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="p">,</span> <span class="n">adress</span><span class="p">,</span> <span class="n">foundation_date</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">faculty_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">campus_id</span> <span class="o">=</span> <span class="n">campus_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortened_name</span> <span class="o">=</span> <span class="n">shortened_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">adress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foundation_date</span> <span class="o">=</span> <span class="n">foundation_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone_number</span> <span class="o">=</span> <span class="n">phone_number</span>

    <span class="k">def</span> <span class="nf">get_faculty_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="department">
<h3>Department<a class="headerlink" href="#department" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Department class from <code class="docutils literal notranslate"><span class="pre">department.py</span></code></span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Department</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">shortened_name</span><span class="p">,</span> <span class="n">block_number</span><span class="p">,</span> <span class="n">budget</span><span class="p">,</span> <span class="n">foundation_date</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">department_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faculty_id</span> <span class="o">=</span> <span class="n">faculty_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortened_name</span> <span class="o">=</span> <span class="n">shortened_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_number</span> <span class="o">=</span> <span class="n">block_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">budget</span> <span class="o">=</span> <span class="n">budget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foundation_date</span> <span class="o">=</span> <span class="n">foundation_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone_number</span> <span class="o">=</span> <span class="n">phone_number</span>

    <span class="k">def</span> <span class="nf">get_department_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="view-models">
<h2>View Models<a class="headerlink" href="#view-models" title="Permalink to this headline">¶</a></h2>
<p>View models handle GET/POST requests and render pages accordingly.</p>
<p>Models implemented by this user can be examined in detailed with the given source code from <code class="docutils literal notranslate"><span class="pre">views.py</span></code> file.</p>
<p>Errors from SQL quarries are handled and required information is shown to user.</p>
<p>Given code snippets below are written by this member.</p>
<div class="section" id="id2">
<h3>Campus<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">View for the Add Campus page</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">campus</span><span class="p">():</span>
    <span class="k">if</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
        <span class="n">campuses</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_campuses</span><span class="p">()</span>
        <span class="n">campus</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">add_campus_form</span><span class="p">()</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;delete_campus_flag&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">campus_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;delete_campus_flag&#39;</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">delete_campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus&#39;</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;----&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForeignKeyViolation</span><span class="p">):</span>
                    <span class="n">str_e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;faculty&#39;</span> <span class="ow">in</span> <span class="n">str_e</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;There are faculties in this campus! It can not be deleted!&quot;</span>
                <span class="k">pass</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># &#39;form&#39;: form,</span>
                <span class="s1">&#39;campuses&#39;</span><span class="p">:</span> <span class="n">campuses</span><span class="p">,</span>
                <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;add_campus_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">file_extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span><span class="p">(</span><span class="n">validate_image</span><span class="p">(</span><span class="n">file_extension</span><span class="p">)):</span>
                    <span class="n">img_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">file_extension</span> <span class="o">=</span> <span class="s2">&quot;NO_IMAGE&quot;</span>
                    <span class="n">img_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
                <span class="n">campus</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="n">form</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">,</span> <span class="n">img_data</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">add_campus</span><span class="p">(</span><span class="n">campus</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span>
                <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="c1"># &#39;form&#39;: form,</span>
                    <span class="s1">&#39;campuses&#39;</span><span class="p">:</span> <span class="n">campuses</span><span class="p">,</span>
                    <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                    <span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="n">error</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s2">&quot;redirect_edit_page&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">campus_form_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;redirect_edit_page&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus_form_id</span><span class="p">))</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># &#39;form&#39;: form,</span>
            <span class="s1">&#39;campuses&#39;</span><span class="p">:</span> <span class="n">campuses</span><span class="p">,</span>
            <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="n">error</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">View for the Campus Edit page</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">campus_detailed</span><span class="p">(</span><span class="n">campus_id</span><span class="p">):</span>
    <span class="k">if</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">):</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
        <span class="n">campus</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">)</span>
        <span class="n">edit_campus_form</span> <span class="o">=</span> <span class="n">add_campus_form</span><span class="p">()</span>
        <span class="n">add_faculty</span> <span class="o">=</span> <span class="n">add_faculty_form</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">img_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">image_extension</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">img_extension</span> <span class="o">!=</span> <span class="s2">&quot;NO_IMAGE&quot;</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">img_data</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">image_extension</span> <span class="o">=</span> <span class="n">campus</span><span class="o">.</span><span class="n">img_extension</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">image_extension</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">faculties</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_faculties_from_campus</span><span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;change_picture&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
            <span class="n">error</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">validate_image</span><span class="p">(</span><span class="n">file_extension</span><span class="p">)):</span>
                <span class="n">img_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">updated_campus</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                                    <span class="n">campus</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">,</span> <span class="n">img_data</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">update_campus</span><span class="p">(</span><span class="n">updated_campus</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus_id</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
                <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
                <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
                <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
                <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
                <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
                <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s2">&quot;delete_image&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
            <span class="n">updated_campus</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                                    <span class="n">campus</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">,</span> <span class="n">img_data</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">update_campus</span><span class="p">(</span><span class="n">updated_campus</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus_id</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
                <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
                <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
                <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
                <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
                <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
                <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;add_faculty_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">add_faculty</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="n">faculty</span> <span class="o">=</span> <span class="n">Faculty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;add_faculty_form&#39;</span><span class="p">],</span> <span class="n">add_faculty</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_faculty</span><span class="o">.</span><span class="n">shortened_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="n">add_faculty</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_faculty</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_faculty</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">add_faculty</span><span class="p">(</span><span class="n">faculty</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span>

            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
                    <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
                    <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
                    <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
                    <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
                    <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
                    <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;edit_campus_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">campus_id</span> <span class="o">=</span> <span class="n">campus</span><span class="o">.</span><span class="n">id</span>
            <span class="n">updated_campus</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                    <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">img_extension</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">img_data</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">edit_campus_form</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">update_campus</span><span class="p">(</span><span class="n">updated_campus</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">add_faculty</span> <span class="o">=</span> <span class="n">add_faculty_form</span><span class="p">()</span>
                <span class="n">edit_campus_form</span> <span class="o">=</span> <span class="n">add_campus_form</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">edit_campus_form</span><span class="o">.</span><span class="n">errors</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
                <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
                <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
                <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
                <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
                <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
                <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span>
                <span class="s1">&#39;update_error&#39;</span><span class="p">:</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;delete_faculty_flag&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">faculty_delete_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;delete_faculty_flag&#39;</span><span class="p">]</span>
            <span class="n">error</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">delete_faculty</span><span class="p">(</span><span class="n">faculty_delete_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;campus_detailed&#39;</span><span class="p">,</span> <span class="n">campus_id</span><span class="o">=</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;----&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForeignKeyViolation</span><span class="p">):</span>
                    <span class="n">str_e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;department&#39;</span> <span class="ow">in</span> <span class="n">str_e</span><span class="p">:</span>
                        <span class="n">remove_error</span> <span class="o">=</span> <span class="s2">&quot;There are departments in this faculty! It can not be deleted!&quot;</span>
                <span class="k">pass</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
                <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
                <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
                <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
                <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
                <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
                <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;remove_error&#39;</span><span class="p">:</span> <span class="n">remove_error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;redirect_edit_page&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">faculty_form_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;redirect_edit_page&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;faculty_detailed&#39;</span><span class="p">,</span> <span class="n">faculty_id</span><span class="o">=</span><span class="n">faculty_form_id</span><span class="p">))</span>

        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># &#39;add_faculty_form&#39;: add_facultyForm,</span>
            <span class="s1">&#39;Campus&#39;</span><span class="p">:</span> <span class="n">campus</span><span class="p">,</span>
            <span class="s1">&#39;edit_campus_form&#39;</span><span class="p">:</span> <span class="n">edit_campus_form</span><span class="p">,</span>
            <span class="s1">&#39;campus_image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
            <span class="s1">&#39;campus_image_extension&#39;</span><span class="p">:</span> <span class="n">image_extension</span><span class="p">,</span>
            <span class="s1">&#39;add_faculty_form&#39;</span><span class="p">:</span> <span class="n">add_faculty</span><span class="p">,</span>
            <span class="s1">&#39;faculties&#39;</span><span class="p">:</span> <span class="n">faculties</span><span class="p">,</span>
            <span class="s1">&#39;image_added&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/campus_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">View for the Upload Campus image</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">upload_campus_image</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">upload_campus_image_form</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">imagefile</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;imagefile&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;imagefile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No file part&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="c1"># if user does not select file, browser also</span>
        <span class="c1"># submit an empty part without filename</span>
        <span class="k">if</span> <span class="n">imagefile</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No selected file&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imagefile</span> <span class="ow">and</span> <span class="n">allowed_file</span><span class="p">(</span><span class="n">imagefile</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">imagefile</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">imagefile</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;list_campus&#39;</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">form</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id3">
<h3>Faculty<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">View for the Faculty Edit page</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">faculty_detailed</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
        <span class="n">classrooms</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_all_classrooms_by_faculty</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">)</span>
        <span class="n">faculty</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_faculty</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">)</span>
        <span class="n">edit_faculty_form</span> <span class="o">=</span> <span class="n">add_faculty_form</span><span class="p">()</span>
        <span class="n">add_department</span> <span class="o">=</span> <span class="n">add_department_form</span><span class="p">()</span>
        <span class="n">departments</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_departments_from_faculty</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Faculty&#39;</span><span class="p">:</span> <span class="n">faculty</span><span class="p">,</span>
            <span class="s1">&#39;edit_faculty_form&#39;</span><span class="p">:</span> <span class="n">edit_faculty_form</span><span class="p">,</span>
            <span class="s1">&#39;add_department_form&#39;</span><span class="p">:</span> <span class="n">add_department</span><span class="p">,</span>
            <span class="s1">&#39;departments&#39;</span><span class="p">:</span> <span class="n">departments</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;add_department_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">add_department</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="n">department</span> <span class="o">=</span> <span class="n">Department</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">,</span> <span class="n">add_department</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_department</span><span class="o">.</span><span class="n">shortened_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_department</span><span class="o">.</span><span class="n">block_number</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                        <span class="n">add_department</span><span class="o">.</span><span class="n">budget</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_department</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">add_department</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">add_department</span><span class="p">(</span><span class="n">department</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;faculty_detailed&#39;</span><span class="p">,</span> <span class="n">faculty_id</span><span class="o">=</span><span class="n">faculty</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">add_error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;add_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_error</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/faculty_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;edit_faculty_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="n">updated_faculty</span> <span class="o">=</span> <span class="n">Faculty</span><span class="p">(</span><span class="n">faculty_id</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">shortened_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                        <span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">update_faculty</span><span class="p">(</span><span class="n">updated_faculty</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;faculty_detailed&#39;</span><span class="p">,</span> <span class="n">faculty_id</span><span class="o">=</span><span class="n">faculty</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">update_error</span> <span class="o">=</span> <span class="n">tidy_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;update_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_error</span>
                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;faculty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_faculty</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">edit_faculty_form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/faculty_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;delete_department_flag&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">delete_department</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;delete_department_flag&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;faculty_detailed&#39;</span><span class="p">,</span> <span class="n">faculty_id</span><span class="o">=</span><span class="n">faculty</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">remove_error</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;----&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="s1">&#39;student&#39;</span> <span class="ow">in</span> <span class="n">remove_error</span><span class="p">):</span>
                    <span class="n">remove_error</span> <span class="o">=</span> <span class="s2">&quot;The department cannot be deleted because of registered students&quot;</span>
                <span class="k">pass</span>
            <span class="n">context</span><span class="p">[</span><span class="s1">&#39;remove_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">remove_error</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/faculty_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;redirect_edit_page&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">:</span>
            <span class="n">department_form_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;redirect_edit_page&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;department_detailed&#39;</span><span class="p">,</span> <span class="n">department_id</span><span class="o">=</span><span class="n">department_form_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/faculty_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">classrooms</span><span class="o">=</span><span class="n">classrooms</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id4">
<h3>Department<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">View for the Department Edit page</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">department_detailed</span><span class="p">(</span><span class="n">department_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
        <span class="n">department</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_department</span><span class="p">(</span><span class="n">department_id</span><span class="p">)</span>
        <span class="n">edit_department_form</span> <span class="o">=</span> <span class="n">add_department_form</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Department&#39;</span><span class="p">:</span> <span class="n">department</span><span class="p">,</span>
            <span class="s1">&#39;edit_department_form&#39;</span><span class="p">:</span> <span class="n">edit_department_form</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s1">&#39;edit_department_form&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">edit_department_form</span><span class="o">.</span><span class="n">validate</span><span class="p">()):</span>
                <span class="n">updated_department</span> <span class="o">=</span> <span class="n">Department</span><span class="p">(</span><span class="n">department</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">faculty_id</span><span class="p">,</span> <span class="n">edit_department_form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_department_form</span><span class="o">.</span><span class="n">shortened_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                <span class="n">edit_department_form</span><span class="o">.</span><span class="n">block_number</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_department_form</span><span class="o">.</span><span class="n">budget</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_department_form</span><span class="o">.</span><span class="n">foundation_date</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">edit_department_form</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">update_department</span><span class="p">(</span><span class="n">updated_department</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;department_detailed&#39;</span><span class="p">,</span> <span class="n">department_id</span><span class="o">=</span><span class="n">department</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;----&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;department_detailed&#39;</span><span class="p">,</span> <span class="n">department_id</span><span class="o">=</span><span class="n">department</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edit_department_form</span><span class="o">.</span><span class="n">errors</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;/campuses/department_detailed.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="database-queries">
<h2>Database Queries<a class="headerlink" href="#database-queries" title="Permalink to this headline">¶</a></h2>
<p>Database queries are handled via <code class="docutils literal notranslate"><span class="pre">database.py</span></code> file by constructing a Database class and using <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> library as the PostgreSQL driver.</p>
<p>Below are the related class methods implemented by this member:</p>
<div class="section" id="id5">
<h3>Campus<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Campus Table</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into campus (name, address, city, size, foundation_date, phone_number,campus_image_extension,campus_image_data) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2"> ,</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
                               <span class="n">campus</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span>
                               <span class="n">campus</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span><span class="n">campus</span><span class="o">.</span><span class="n">img_extension</span><span class="p">,</span>
                               <span class="n">campus</span><span class="o">.</span><span class="n">img_data</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;End of the campus add function&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">campuses</span><span class="p">[</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">campus</span>
    <span class="k">return</span> <span class="n">campus</span><span class="o">.</span><span class="n">id</span>

<span class="k">def</span> <span class="nf">delete_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from campus where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hey&#39;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update campus set name = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, size = </span><span class="si">%s</span><span class="s2">, foundation_date = </span><span class="si">%s</span><span class="s2">, phone_number = </span><span class="si">%s</span><span class="s2">,campus_image_extension = </span><span class="si">%s</span><span class="s2">, campus_image_data = </span><span class="si">%s</span><span class="s2"> where (id= </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>
                               <span class="n">campus</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">img_extension</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">img_data</span><span class="p">,</span>
                               <span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_campus_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update campus set file_extension = </span><span class="si">%s</span><span class="s2">, image_data = </span><span class="si">%s</span><span class="s2"> where (id= </span><span class="si">% s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus</span><span class="o">.</span><span class="n">file_extension</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">image_data</span><span class="p">,</span> <span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">get_campuses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">campuses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from campus order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cursor.rowcount&#39;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">campus</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">campuses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">campus</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">campus</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">campuses</span>

<span class="k">def</span> <span class="nf">get_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from campus where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus_id</span><span class="p">,))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="n">campus_</span> <span class="o">=</span> <span class="n">Campus</span><span class="p">(</span><span class="o">*</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[:])</span>  <span class="c1"># Inline unpacking of a tuple</span>
    <span class="k">return</span> <span class="n">campus_</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id6">
<h3>Faculty<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Faculty Table</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_faculty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into faculty (campus_id, name, shortened_name, address, foundation_date, phone_number) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">faculty</span><span class="o">.</span><span class="n">campus_id</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span>
                               <span class="n">faculty</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">phone_number</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_faculty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update faculty set name = </span><span class="si">%s</span><span class="s2">, shortened_name = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, foundation_date = </span><span class="si">%s</span><span class="s2">, phone_number = </span><span class="si">%s</span><span class="s2"> where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">faculty</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
                               <span class="n">faculty</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">faculty</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">delete_faculty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from faculty where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">faculty_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">get_faculties_from_campus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">campus_id</span><span class="p">):</span>
    <span class="n">faculties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from faculty where (campus_id = </span><span class="si">%s</span><span class="s2">) order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">campus_id</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cursor.rowcount&#39;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">faculty</span> <span class="o">=</span> <span class="n">Faculty</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">faculties</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">faculty</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">faculty</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">faculties</span>

<span class="k">def</span> <span class="nf">get_faculty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from faculty where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">faculty_id</span><span class="p">,))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Inline unpacking of a tuple</span>
    <span class="n">faculty_</span> <span class="o">=</span> <span class="n">Faculty</span><span class="p">(</span><span class="o">*</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[:])</span>
    <span class="k">return</span> <span class="n">faculty_</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id7">
<h3>Department<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">CRUD Operations for the Department Table</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_department</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">department</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enter add department&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">department</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;insert into department (faculty_id, name, shortened_name, block_number, budget, foundation_date, phone_number) values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">department</span><span class="o">.</span><span class="n">faculty_id</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span>
                        <span class="n">department</span><span class="o">.</span><span class="n">block_number</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">budget</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span>
                        <span class="n">department</span><span class="o">.</span><span class="n">phone_number</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">update_department</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">department</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update department set name = </span><span class="si">%s</span><span class="s2">, shortened_name = </span><span class="si">%s</span><span class="s2">, block_number = </span><span class="si">%s</span><span class="s2">, budget = </span><span class="si">%s</span><span class="s2">, foundation_date = </span><span class="si">%s</span><span class="s2">, phone_number = </span><span class="si">%s</span><span class="s2"> where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span>
            <span class="n">department</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">shortened_name</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">block_number</span><span class="p">,</span>
            <span class="n">department</span><span class="o">.</span><span class="n">budget</span><span class="p">,</span>
            <span class="n">department</span><span class="o">.</span><span class="n">foundation_date</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span> <span class="n">department</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">delete_department</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">department_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;delete from department where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">department_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span>

<span class="k">def</span> <span class="nf">get_departments_from_faculty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faculty_id</span><span class="p">):</span>
    <span class="n">departments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from department where (faculty_id = </span><span class="si">%s</span><span class="s2">) order by id asc&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">faculty_id</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cursor.rowcount&#39;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">department</span> <span class="o">=</span> <span class="n">Department</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[:])</span>
            <span class="n">departments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">department</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">department</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">departments</span>

<span class="k">def</span> <span class="nf">get_department</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">department_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select * from department where (id = </span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">department_id</span><span class="p">,))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Inline unpacking of a tuple</span>
    <span class="n">department_</span> <span class="o">=</span> <span class="n">Department</span><span class="p">(</span><span class="o">*</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[:])</span>
    <span class="k">return</span> <span class="n">department_</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Following templates are written by <strong>this user</strong>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">campuses/campus.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">campuses/campus_detailed.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">campuses/faculty_detailed.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">campuses/department_detailed.html.html</span></code></p></li>
</ul>
</dd>
<dt>Following templates are written both by <strong>this member</strong> and <strong>other teammates</strong>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">layout.html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">login.html</span></code></p></li>
</ul>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="Zeynep Yetistiren.html" class="btn btn-neutral float-left" title="Parts Implemented by Zeynep Yetiştiren" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ITUCSDB1922

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>